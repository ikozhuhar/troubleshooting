# Troubleshooting

### <a name='toc'>Содержание</a>

1. [Диски](#1)
2. [Процессор и память](#2)
3. [Процессы](#3)
4. [Сеть ](#4)
5. [Логи](#5)
6. [Программа fsck — проверка файловых систем](#6)
7. [Программа memtest86 — проверка оперативной памяти ](#7)
8. [Использование LiveCD](#8)
9. [Программа fsck — проверка файловых систем](#9)


## [[⬆]](#toc) <a name='1'>Диски</a>
```
sudo du -sch /*
sudo df -h
sudo lsblk -o +name,fstype,uuid
sudo blkid
smartctl  
/proc/mdstat
```

## [[⬆]](#toc) <a name='2'>Процессор и память</a>

iostat  
iotop  
top  
atop  
vmstat  
free  
/proc/meminfo  

## [[⬆]](#toc) <a name='3'>Процессы</a>

ps -efl | -aux  
strace  
systemctl status nginx  
kill -9 pid  

## [[⬆]](#toc) <a name='4'>Сеть</a>

netstat | ss  
ip a | ifconfig  
netstat -rm | route | ip r  
ping  
traceroute  
mtr  
dig  
nslookup  
curl  
curl telnet  
tcpdump  
ethtool

## [[⬆]](#toc) <a name='5'>Логи</a>

journalctl  
/var/log/dmesg  
/var/log  
/var/log/syslog   


## [[⬆]](#toc) <a name='6'>Программа fsck — проверка файловых систем</a>

Программа fsck используется для проверки файловых систем и для коррекции ошибок файловой системы, если таковые найдутся. Основное требование для проверки файловой системы: файловая система должна быть размонтирована. Запуск fsck для уже смонтированной файловой системы может привести к ее разрушению — тогда уже даже и fsck не поможет. Программа fsck может использоваться для проверки файловых систем, которые поддерживаются ядром Linux.

Приведем пошаговые инструкции по восстановлению файловой системы.

1. Переходим в однопользовательский режим. Для этого входим с правами суперпользователя и набираем команду:
```
init 1 
```

2. Следующим шагом демонтируем файловую систему, которую мы будем проверять. Пусть это будет /mnt/sdb1 (файловая система, которая в нашем примере соответствует первичному диску на втором SCSI-диске). Для этого вводим команду:
```
umount /mnt/sdb1
```

В случае, если речь идет о корневой файловой системе, то демонтировать ее невозможно, поэтому перемонтируем ее в режиме только для чтения:
```
mount —n —o remount,ro /
```

3. Запускаем проверку файловой системы:
```
fsck —f /dev/sdb1 
```

4. Проверенные и исправленные файловые системы необходимо смонтировать снова:
```
mount /mnt/sdb1 
```

Или для корневой файловой системы:
```
mount —n —o remount, rw / 
```

5. Возвращаемся к исходному уровню работы, если это был графический режим, то:
```
init 5
```

Если по умолчанию вы запускаетесь в текстовом режиме, то это будет команда:
```
init 3 
```



## [[⬆]](#toc) <a name='7'>Программа memtest86 — проверка оперативной памяти</a>

Для тестирования оперативной памяти используется программа memtest86. Программа memtest86 работает не как обычная программа. После установки программы устанавливается специальный загрузочный образ, а для запуска
программы вы должны перезапустить компьютер и выбрать этот образ из меню вашего загрузчика.

1. Перезагрузите систему и выберите из меню загрузчика memtest. Запустится программа memtest86, которая сразу начнет тестировать вашу оперативную память, и если произойдет ошибка, программа непременно сообщит вам об этом.



## [[⬆]](#toc) <a name='8'>Использование LiveCD</a>

1. Загрузка с LiveCD
2. Монтирование корневой файловой системы установленной ОС к корневой файловой системе LiveCD.
3. Смотрим логи хостовой ОС `journalctl -D /mnt/hd/var/log/journal` или `journalctl --directory=/mnt/hd/var/log/journal`.
4. fsck — проверка файловых систем

**Восстановления загрузчика Linux**

1. Загрузка с LiveCD
2. Монтирование корневой файловой системы установленной ОС к корневой файловой системе LiveCD.
3. Изменение корневой файловой системы.
4. Установка загрузчика. 

Рассмотрим процедуру восстановления загрузчика Linux, установленного в разделе /dev/hda6. После загрузки с LiveCD введите следующие команды:

```
mkdir /old_root
mount /dev/hda6 /old_root
chroot /old_root 
/sbin/grub-install /dev/hda 
```
